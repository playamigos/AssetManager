global proc amDeleteFolder( string $folderPath ) { string $subFiles[] = `getFileList -folder $folderPath`; for( $eachFile in $subFiles ) { if( `filetest -d ($folderPath+"/"+$eachFile)` ) amDeleteFolder( $folderPath+"/"+$eachFile ); else sysFile -delete ($folderPath+"/"+$eachFile); } sysFile -removeEmptyDir $folderPath; } global string $amsCurrentLibPath; string $searchFolder = $amsCurrentLibPath + "\\.tags"; amDeleteFolder($searchFolder); if(!`filetest -d $searchFolder`) sysFile -md $searchFolder; global string $allMayaFiles[]; clear $allMayaFiles; global proc amGetMayaFiles( string $folderPath ) { global string $allMayaFiles[]; string $subFiles[] = `getFileList -folder $folderPath`; for( $eachFile in $subFiles ) { if( `filetest -d ($folderPath+"\\"+$eachFile)` ) amGetMayaFiles( $folderPath+"\\"+$eachFile ); else { $ext = fileExtension($eachFile); if($ext == "ma" || $ext == "mb") { $allMayaFiles[(size($allMayaFiles))] = ( $folderPath+"\\"+$eachFile ); } } } } amGetMayaFiles($amsCurrentLibPath); global string $gMainProgressBar; progressBar -edit -beginProgress -isInterruptable true -status "Indexing Assets in library" -maxValue (size($allMayaFiles)) $gMainProgressBar; int $i; for($i=0; $i < size($allMayaFiles); $i++) { if(`progressBar -query -isCancelled $gMainProgressBar`) break; string $selfTagPath = dirname($allMayaFiles[$i]) + "\\.amtags\\"+basename($allMayaFiles[$i], "" ) + ".tag"; if(`filetest -f $selfTagPath`) { string $tags[]; int $fileId = `fopen $selfTagPath "r"`; string $line1 = `fgetline $fileId`; $numTags = `tokenize $line1 " ,.@#*/'|][<>?\\()!$%_+-\n" $tags`; if($numTags==1 && $tags[0] == "") { clear $tags; } fclose $fileId; string $tag; for($tag in $tags) { $tagPath = $searchFolder + "\\" + $tag; if(`filetest -f $tagPath`) { int $fileId = `fopen $tagPath "a"`; fprint $fileId ("\n"+$allMayaFiles[$i]); fclose $fileId; } else { int $fileId = `fopen $tagPath "w"`; fprint $fileId $allMayaFiles[$i]; fclose $fileId; } } } progressBar -edit -step 1 $gMainProgressBar; } progressBar -edit -endProgress $gMainProgressBar;